{% extends "base.html" %}
{% load static %}

{% block title %}산재 뉴스{% endblock %}

{% block script1 %}
<link rel="stylesheet" href="{% static 'CSS/news/news_list.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
{% endblock %}

{% block contents %}
<div class="container py-5">

  <div class="news-header text-center mb-5">
    <p class="subtitle">산업재해 예방 정보</p>
    <h2 class="fw-bold" style="color:#23333d;">산재 뉴스</h2>
  </div>

  <form method="get" id="filterForm" class="filter-wrapper shadow-sm">

    <div class="filter-group">
      <div class="filter-label">작성일</div>
      <div class="filter-controls">
        <input type="text" name="start_date" id="startDate"
               class="form-control date-input" placeholder="시작일"
               value="{{ start_date }}">
        <span>~</span>
        <input type="text" name="end_date" id="endDate"
               class="form-control date-input" placeholder="종료일"
               value="{{ end_date }}">
      </div>
    </div>

    <div class="filter-group">
      <div class="filter-label">검색범위</div>
      <div class="filter-controls">
        <select name="search_type" class="form-select">
          <option value="all" {% if search_type == 'all' %}selected{% endif %}>제목 + 내용</option>
          <option value="title" {% if search_type == 'title' %}selected{% endif %}>제목</option>
          <option value="content" {% if search_type == 'content' %}selected{% endif %}>내용</option>
          <option value="author" {% if search_type == 'author' %}selected{% endif %}>작성자</option>
        </select>
      </div>
    </div>

    <div class="filter-group">
      <div class="filter-label">검색</div>
      <div class="filter-controls search-box">
        <input type="text" name="q" class="form-control search-input"
               placeholder="검색어 입력" value="{{ search_keyword }}">
        <button type="submit" class="btn btn-outline-secondary btn-search">검색</button>
        <a href="{% url 'News:news_list' %}" class="btn btn-outline-secondary">초기화</a>
      </div>
    </div>

    
  </form>

  {% for n in list %}
  <div class="news-card">
    <div class="news-img">
      {% if n.n_image_url %}
        <a href="{{ n.n_link }}" target="_blank">
          <img src="{{ n.n_image_url }}" alt="썸네일">
        </a>
      {% else %}
        <div class="no-image">이미지 없음</div>
      {% endif %}
    </div>

    <div class="news-info">
      <div class="news-title">
        <a href="{{ n.n_link }}" target="_blank">{{ n.n_title }}</a>
      </div>
      <div class="news-content">
        <a href="{{ n.n_link }}" target="_blank">{{ n.n_contents }}</a>
      </div>
      <div class="news-meta">
        <span>작성자: {{ n.n_writer }}</span> |
        <span>작성일: {{ n.n_created_at|slice:":11" }}</span>
      </div>
    </div>
  </div>
  {% endfor %}

  <!-- 페이지네이션 (필터 유지) -->
  <div class="container mt-5">
    <ul class="pagination justify-content-center">

      {% if list.number > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page=1{% if query_params %}&{{ query_params }}{% endif %}">
          <span class="page-arrow">&laquo;</span> 처음</a>
      </li>
      {% endif %}

      {% if start_page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page={{ start_page|add:-1 }}{% if query_params %}&{{ query_params }}{% endif %}">
          <span class="page-arrow">&lsaquo;</span> 이전</a>
      </li>
      {% endif %}

      {% for i in page_range %}
        {% if list.number == i %}
          <li class="page-item active"><span class="page-link">{{ i }}</span></li>
        {% else %}
          <li class="page-item">
            <a class="page-link" href="?page={{ i }}{% if query_params %}&{{ query_params }}{% endif %}">{{ i }}</a>
          </li>
        {% endif %}
      {% endfor %}

      {% if list.paginator.num_pages > end_page %}
      <li class="page-item">
        <a class="page-link" href="?page={{ end_page|add:1 }}{% if query_params %}&{{ query_params }}{% endif %}">
          다음 <span class="page-arrow">&rsaquo;</span></a>
      </li>
      {% endif %}

      {% if list.number < list.paginator.num_pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ list.paginator.num_pages }}{% if query_params %}&{{ query_params }}{% endif %}">
          맨끝 <span class="page-arrow">&raquo;</span></a>
      </li>
      {% endif %}

    </ul>
  </div>

</div>
{% endblock %}

{% block script2 %}
<script src="{% static 'js/news/news_list.js' %}"></script>
{% endblock %}
