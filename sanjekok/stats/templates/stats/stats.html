{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ì¶¤ ì‚°ì¬ í†µê³„</title>
    <link rel="stylesheet" href="{% static 'CSS/stats/stats.css' %}">
    <style>

    </style>
</head>
<body>
{% block content %}
<div class="stats-container">
    <!-- 1. í”„ë¡œí•„ ì˜ì—­ -->
    <section class="profile-box">
        <div class="profile-left">
            <div class="profile-icon">ğŸ‘¤</div>
            <div class="profile-info">
                <h2>{{ member.m_name }} ë‹˜ì˜ í”„ë¡œí•„</h2>
                <p>
                    {{ industry.i_industry_type2 }} / {{ member.m_sex }} / {{ age }}ì„¸
                </p>
                <!-- ë‚˜ì˜ ì‚°ì¬ ëˆŒë €ì„ ë•Œ ë‚˜ì˜¤ëŠ” ì¶”ê°€ ìƒì„¸ ì •ë³´ -->
                <div id="injuryDetail"></div>
            </div>
        </div>
        <div class="profile-edit-btn">
            <button id="myInjuryBtn">ë‚˜ì˜ ì‚°ì¬ â–¼</button>
            <!-- ë“œë¡­ë‹¤ìš´ -->
            <ul id="injuryDropdown" class="dropdown hidden">
                {% for ind in individual_list %}
                <li data-id="{{ ind.id }}"
                    data-title="{{ ind.i_title }}"
                    data-injury="{{ ind.i_injury }}"
                    data-disease="{{ ind.i_disease_type }}"
                    data-date="{{ ind.i_accident_date }}">
                    {{ ind.i_title }}
                </li>
                {% endfor %}
            </ul>
        </div>
    </section>

    <!-- 2. ë¶„ì„ ê¸°ê°„ ì„ íƒ -->
    <section class="period-section">
        <h3>ë¶„ì„ ê¸°ê°„:</h3>
        <div class="period-buttons">
            <!-- ìµœê·¼ 1ë…„ -->
            <button class="period-btn" data-year="1"
                data-acc-count="{{ summary1.0.ì¬í•´ììˆ˜ }}"
                data-acc-rate="{{ summary1.0.ì¬í•´ìœ¨ }}"
                data-fatal-count="{{ summary1.0.ì‚¬ë§ììˆ˜ }}"
                data-fatal-rate="{{ summary1.0.ì‚¬ë§ë§Œì¸ìœ¨ }}"
                data-male="{{ summary2.0.ë‚¨ì }}"
                data-female="{{ summary2.0.ì—¬ì }}"
                data-male-rate="{{ summary2.0.ë‚¨ìë¹„ìœ¨ }}"
                data-female-rate="{{ summary2.0.ì—¬ìë¹„ìœ¨ }}"
                data-male2="{{ summary3.0.ë‚¨ì }}"
                data-female2="{{ summary3.0.ì—¬ì }}"
                data-male-rate2="{{ summary3.0.ë‚¨ìë¹„ìœ¨ }}"
                data-female-rate2="{{ summary3.0.ì—¬ìë¹„ìœ¨ }}"
                data-ageu18="{{ summary4.0.18ì„¸ë¯¸ë§Œ }}"
                data-age20s="{{ summary4.0.20ëŒ€ }}"
                data-age30s="{{ summary4.0.30ëŒ€ }}"
                data-age40s="{{ summary4.0.40ëŒ€ }}"
                data-age50s="{{ summary4.0.50ëŒ€ }}"
                data-age60p="{{ summary4.0.60ëŒ€ì´ìƒ }}"
                data-ageu18a="{{ summary5.0.18ì„¸ë¯¸ë§Œ }}"
                data-age20sa="{{ summary5.0.20ëŒ€ }}"
                data-age30sa="{{ summary5.0.30ëŒ€ }}"
                data-age40sa="{{ summary5.0.40ëŒ€ }}"
                data-age50sa="{{ summary5.0.50ëŒ€ }}"
                data-age60pa="{{ summary5.0.60ëŒ€ì´ìƒ }}">
                ìµœê·¼ 1ë…„
            </button>

            <!-- ìµœê·¼ 2ë…„ -->
            <button class="period-btn" data-year="2"
                data-acc-count="{{ summary1.1.ì¬í•´ììˆ˜ }}"
                data-acc-rate="{{ summary1.1.ì¬í•´ìœ¨ }}"
                data-fatal-count="{{ summary1.1.ì‚¬ë§ììˆ˜ }}"
                data-fatal-rate="{{ summary1.1.ì‚¬ë§ë§Œì¸ìœ¨ }}"
                data-male="{{ summary2.1.ë‚¨ì }}"
                data-female="{{ summary2.1.ì—¬ì }}"
                data-male-rate="{{ summary2.1.ë‚¨ìë¹„ìœ¨ }}"
                data-female-rate="{{ summary2.1.ì—¬ìë¹„ìœ¨ }}"
                data-male2="{{ summary3.1.ë‚¨ì }}"
                data-female2="{{ summary3.1.ì—¬ì }}"
                data-male-rate2="{{ summary3.1.ë‚¨ìë¹„ìœ¨ }}"
                data-female-rate2="{{ summary3.1.ì—¬ìë¹„ìœ¨ }}"
                data-ageu18="{{ summary4.1.18ì„¸ë¯¸ë§Œ }}"
                data-age20s="{{ summary4.1.20ëŒ€ }}"
                data-age30s="{{ summary4.1.30ëŒ€ }}"
                data-age40s="{{ summary4.1.40ëŒ€ }}"
                data-age50s="{{ summary4.1.50ëŒ€ }}"
                data-age60p="{{ summary4.1.60ëŒ€ì´ìƒ }}"
                data-ageu18a="{{ summary5.1.18ì„¸ë¯¸ë§Œ }}"
                data-age20sa="{{ summary5.1.20ëŒ€ }}"
                data-age30sa="{{ summary5.1.30ëŒ€ }}"
                data-age40sa="{{ summary5.1.40ëŒ€ }}"
                data-age50sa="{{ summary5.1.50ëŒ€ }}"
                data-age60pa="{{ summary5.1.60ëŒ€ì´ìƒ }}">
                2ë…„
            </button>

            <!-- ìµœê·¼ 3ë…„ -->
            <button class="period-btn" data-year="3"
                data-acc-count="{{ summary1.2.ì¬í•´ììˆ˜ }}"
                data-acc-rate="{{ summary1.2.ì¬í•´ìœ¨ }}"
                data-fatal-count="{{ summary1.2.ì‚¬ë§ììˆ˜ }}"
                data-fatal-rate="{{ summary1.2.ì‚¬ë§ë§Œì¸ìœ¨ }}"
                data-male="{{ summary2.2.ë‚¨ì }}"
                data-female="{{ summary2.2.ì—¬ì }}"
                data-male-rate="{{ summary2.2.ë‚¨ìë¹„ìœ¨ }}"
                data-female-rate="{{ summary2.2.ì—¬ìë¹„ìœ¨ }}"
                data-male2="{{ summary3.2.ë‚¨ì }}"
                data-female2="{{ summary3.2.ì—¬ì }}"
                data-male-rate2="{{ summary3.2.ë‚¨ìë¹„ìœ¨ }}"
                data-female-rate2="{{ summary3.2.ì—¬ìë¹„ìœ¨ }}"
                data-ageu18="{{ summary4.2.18ì„¸ë¯¸ë§Œ }}"
                data-age20s="{{ summary4.2.20ëŒ€ }}"
                data-age30s="{{ summary4.2.30ëŒ€ }}"
                data-age40s="{{ summary4.2.40ëŒ€ }}"
                data-age50s="{{ summary4.2.50ëŒ€ }}"
                data-age60p="{{ summary4.2.60ëŒ€ì´ìƒ }}"
                data-ageu18a="{{ summary5.2.18ì„¸ë¯¸ë§Œ }}"
                data-age20sa="{{ summary5.2.20ëŒ€ }}"
                data-age30sa="{{ summary5.2.30ëŒ€ }}"
                data-age40sa="{{ summary5.2.40ëŒ€ }}"
                data-age50sa="{{ summary5.2.50ëŒ€ }}"
                data-age60pa="{{ summary5.2.60ëŒ€ì´ìƒ }}">
                3ë…„
            </button>
        </div>
    </section>

    <!-- 3. í†µê³„ ì‹œê°í™” ì˜ì—­ -->
    <section id="stats-visual-area" class="stats-visual hidden"
        data-summary6='{{ summary6_json}}'
        data-summary7='{{ summary7_json}}'
        data-summary8='{{ summary8_json}}'
        data-summary9='{{ summary9_json}}'
        data-age-band="{{ age_group }}">
        
        <div class="visual-grid">
            <!-- ë‚´ ì—…ì¢… ì¬í•´ìœ¨ -->
            <div class="visual-card small">
                <h3>ë‚´ ì—…ì¢… ì¬í•´ìœ¨</h3>
                <p id="accidentSummary"></p>
            </div>

            <!-- ë‚´ ì—…ì¢… ì‚¬ë§ë§Œì¸ìœ¨ -->
            <div class="visual-card small">
                <h3>ë‚´ ì—…ì¢… ì‚¬ë§ë§Œì¸ìœ¨</h3>
                <p id="fatalSummary"></p>
            </div>

            <!-- ë‚¨/ë…€ ì¬í•´ í˜„í™© -->
            <div class="visual-card">
                <h3>ë‚¨/ë…€ ì¬í•´ í˜„í™©</h3>
                <p id="genderSummary1"></p>
                <canvas id="genderChart1"></canvas>
            </div>

            <!-- ë‚¨/ë…€ ì¬í•´ ì‚¬ë§í˜„í™© -->
            <div class="visual-card">
                <h3>ë‚¨/ë…€ ì¬í•´ ì‚¬ë§ í˜„í™©</h3>
                <p id="genderSummary2"></p>
                <canvas id="genderChart2"></canvas>
            </div>

            <!-- ì—°ë ¹ëŒ€ë³„ ì¬í•´ í˜„í™© (1ì—´ ì „ì²´ ì‚¬ìš©) -->
            <div class="visual-card" id="card-age">
                <h3>ì—°ë ¹ëŒ€ë³„ ì¬í•´ í˜„í™©</h3>
                <p id="ageSummary1"></p>
                <canvas id="ageChart1"></canvas>
            </div>

            <!-- ì—°ë ¹ëŒ€ë³„ ì‚¬ë§ í˜„í™© (1ì—´ ì „ì²´ ì‚¬ìš©) -->
            <div class="visual-card" id="card-age-fatal">
                <h3>ì—°ë ¹ëŒ€ë³„ ì¬í•´ ì‚¬ë§ í˜„í™©</h3>
                <p id="ageSummary2"></p>
                <canvas id="ageChart2"></canvas>
            </div>

            <!-- ë°œìƒí˜•íƒœë³„ ì¬í•´ TOP 10 (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div class="visual-card" id="card-injury" style="display:none;">
                <h3>ì¬í•´ìœ í˜• </h3>
                <p id="injurySummary1"></p>
                <canvas id="injuryChart1"></canvas>
            </div>

            <!-- ì‚¬ë§ì¬í•´í˜„í™© (ë°œìƒí˜•íƒœ TOP 10) (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div class="visual-card" id="card-injury-fatal" style="display:none;">
                <h3>ì‚¬ë§ì¬í•´í˜„í™© </h3>
                <p id="injurySummary2"></p>
                <canvas id="injuryChart2"></canvas>
            </div>

            <!-- ì¬í•´ ì§ˆë³‘ìœ í˜• (TOP 10) (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div class="visual-card" id="card-disease" style="display:none;">
                <h3>ì¬í•´ ì§ˆë³‘ìœ í˜• </h3>
                <p id="diseaseSummary1"></p>
                <canvas id="diseaseChart1"></canvas>
            </div>

            <!-- ì¬í•´ ì§ˆë³‘ ì‚¬ë§ í˜„í™© (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div class="visual-card" id="card-disease-fatal" style="display:none;">
                <h3>ì¬í•´ ì§ˆë³‘ ì‚¬ë§ í˜„í™©</h3>
                <p id="diseaseSummary2"></p>
                <canvas id="diseaseChart2"></canvas>
            </div>

                        <!-- ì¢…í•© ìœ„í—˜ë„ í‰ê°€ ì¹´ë“œ -->
            <div class="visual-card highlight" id="card-risk">
                <div class="risk-header">
                    <h3 style="margin: 0;">ì¢…í•© ìœ„í—˜ë„ í‰ê°€</h3>
                    
                </div>
                
                {% if risk_analysis and risk_analysis.has_data %}
                <div class="risk-section">
                    <p class="risk-condition">
                        <span style="font-size:20px;"> 
                        <strong>{{ risk_analysis.industry }}</strong>, 
                        <strong>{{ risk_analysis.age_group }}</strong>, 
                        <strong>{{ risk_analysis.gender }}</strong> ì¡°ê±´ì—ì„œ<br>
                        ìµœê·¼ 3ë…„ê°„ ê°€ì¥ ë§ì´ ë°œìƒí•œ ìœ„í—˜ ìš”ì¸ì…ë‹ˆë‹¤. 
                        </span>
                    </p>
                    
                    <div class="risk-grid">
                        <!-- ë°œìƒí˜•íƒœ TOP 3 -->
                        <div class="risk-category">
                            <div class="risk-category-title">
                                <span class="risk-icon">âš ï¸</span>
                                ë°œìƒí˜•íƒœ TOP 3
                            </div>
                            <div class="risk-category-inner">
                                <div class="risk-list">
                                    {% for item in risk_analysis.injury_top3 %}
                                    <div class="risk-item">
                                        <span class="risk-rank rank-{{ item.rank }}">{{ item.rank }}</span>
                                        <span class="risk-name">{{ item.name }}</span>
                                        <span class="risk-percentage">{{ item.percentage }}%</span>
                                    </div>
                                    {% endfor %}
                            </div>
                                <div class="risk-chart-wrap">
                                    <canvas id="riskAccidentPie"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì§ˆë³‘í˜•íƒœ TOP 3 -->
                        <div class="risk-category">
                            <div class="risk-category-title">
                                <span class="risk-icon">ğŸ¥</span>
                                ì§ˆë³‘í˜•íƒœ TOP 3
                            </div>
                            <div class="risk-category-inner">
                                <div class="risk-list">
                                {% for item in risk_analysis.disease_top3 %}
                                <div class="risk-item">
                                    <span class="risk-rank rank-{{ item.rank }}">{{ item.rank }}</span>
                                    <span class="risk-name">{{ item.name }}</span>
                                    <span class="risk-percentage">{{ item.percentage }}%</span>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="risk-chart-wrap">
                                <canvas id="riskDiseasePie"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="risk-no-data" style="padding: 40px;">
                    ì¶©ë¶„í•œ í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
                </div>
                {% endif %}
            </div>
        </div>
    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script src="{% static 'js/stats/chart.js' %}"></script>
<script src="{% static 'js/stats/stats.js' %}"></script>
{% endblock %}
</body>
</html>