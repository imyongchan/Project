{% extends "base.html" %}
{% load static %}

{% block title %}ë§ì¶¤ ì‚°ì¬ í†µê³„{% endblock %}

{% block script1 %}
<link rel="stylesheet" href="{% static 'CSS/stats/stats.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

{% endblock %}

{% block contents %}
    <div class="stats-container">
        <!-- 1. í”„ë¡œí•„ ì˜ì—­ -->
        <section class="profile-box">
            <div class="profile-left">
                <div class="profile-icon">
                    <img src="{% static 'img/worker.png' %}" alt="ê·¼ë¡œì ì•„ì´ì½˜">
                </div>
                <span class="profile-info">
                    <h2>{{ member.m_name }}ë‹˜ì˜ í”„ë¡œí•„</h2>
                    <p><strong> ì—…ì¢…ëª…</strong>:  {{ industry.i_industry_type2 }}  
                    <p><strong> ì„±ë³„ </strong>:  {{ member.m_sex }}</p>    
                    <p><strong> ë‚˜ì´ </strong>:  ë§Œ {{ age }}ì„¸</p>
                    <!-- ë‚˜ì˜ ì‚°ì¬ ëˆŒë €ì„ ë•Œ ë‚˜ì˜¤ëŠ” ì¶”ê°€ ìƒì„¸ ì •ë³´ -->
                    <div id="injuryDetail">
                        {% if show_detail and selected_individual %}
                            {% if selected_individual.i_title %}
                                <p><strong>ì‚°ì¬ëª…</strong>  :  {{ selected_individual.i_title }}</p>
                            {% endif %}
                            {% if selected_individual.i_injury %}
                                <p><strong>ë°œìƒí˜•íƒœ</strong>  :  {{ selected_individual.i_injury }}</p>
                            {% endif %}
                            {% if selected_individual.i_disease_type %}
                                <p><strong>ì§ˆë³‘</strong>  :  {{ selected_individual.i_disease_type }}</p>
                            {% endif %}
                            {% if selected_individual.i_accident_date %}
                                <p><strong>ë°œìƒì¼ì</strong>  :  {{ selected_individual.i_accident_date }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </span>
            </div>
            <div class="profile-edit-btn">
                <button id="myInjuryBtn">ë‚˜ì˜ ì‚°ì¬ ì„ íƒí•˜ê¸°â–¼</button>
                <!-- ë“œë¡­ë‹¤ìš´ -->
                <ul id="injuryDropdown" class="dropdown hidden">
                    {% for ind in individual_list %}
                    <li data-accident-id="{{ ind.accident_id }}"
                        data-title="{{ ind.i_title }}"
                        data-injury="{{ ind.i_injury }}"
                        data-disease="{{ ind.i_disease_type }}"
                        data-date="{{ ind.i_accident_date }}">
                        {{ ind.i_title }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </section>

        <!-- 2. ë¶„ì„ ê¸°ê°„ ì„ íƒ -->
        <section class="period-section">
            
            <div class="period-buttons">
                <h3>ë¶„ì„ ê¸°ê°„:</h3>
                <button class="period-btn" data-year="1"
                    data-acc-count="{{ summary1.0.ì¬í•´ììˆ˜ }}"
                    data-acc-rate="{{ summary1.0.ì¬í•´ìœ¨ }}"
                    data-fatal-count="{{ summary1.0.ì‚¬ë§ììˆ˜ }}"
                    data-fatal-rate="{{ summary1.0.ì‚¬ë§ë§Œì¸ìœ¨ }}"
                    data-male="{{ summary2.0.ë‚¨ì }}"
                    data-female="{{ summary2.0.ì—¬ì }}"
                    data-male-rate="{{ summary2.0.ë‚¨ìë¹„ìœ¨ }}"
                    data-female-rate="{{ summary2.0.ì—¬ìë¹„ìœ¨ }}"
                    data-male2="{{ summary3.0.ë‚¨ì }}"
                    data-female2="{{ summary3.0.ì—¬ì }}"
                    data-male-rate2="{{ summary3.0.ë‚¨ìë¹„ìœ¨ }}"
                    data-female-rate2="{{ summary3.0.ì—¬ìë¹„ìœ¨ }}"
                    data-ageu18="{{ summary4.0.18ì„¸ë¯¸ë§Œ }}"
                    data-age20s="{{ summary4.0.20ëŒ€ }}"
                    data-age30s="{{ summary4.0.30ëŒ€ }}"
                    data-age40s="{{ summary4.0.40ëŒ€ }}"
                    data-age50s="{{ summary4.0.50ëŒ€ }}"
                    data-age60p="{{ summary4.0.60ëŒ€ì´ìƒ }}"
                    data-ageu18a="{{ summary5.0.18ì„¸ë¯¸ë§Œ }}"
                    data-age20sa="{{ summary5.0.20ëŒ€ }}"
                    data-age30sa="{{ summary5.0.30ëŒ€ }}"
                    data-age40sa="{{ summary5.0.40ëŒ€ }}"
                    data-age50sa="{{ summary5.0.50ëŒ€ }}"
                    data-age60pa="{{ summary5.0.60ëŒ€ì´ìƒ }}">
                    ìµœê·¼ 1ë…„
                </button>

                <!-- ìµœê·¼ 2ë…„ -->
                <button class="period-btn" data-year="2"
                    data-acc-count="{{ summary1.1.ì¬í•´ììˆ˜ }}"
                    data-acc-rate="{{ summary1.1.ì¬í•´ìœ¨ }}"
                    data-fatal-count="{{ summary1.1.ì‚¬ë§ììˆ˜ }}"
                    data-fatal-rate="{{ summary1.1.ì‚¬ë§ë§Œì¸ìœ¨ }}"
                    data-male="{{ summary2.1.ë‚¨ì }}"
                    data-female="{{ summary2.1.ì—¬ì }}"
                    data-male-rate="{{ summary2.1.ë‚¨ìë¹„ìœ¨ }}"
                    data-female-rate="{{ summary2.1.ì—¬ìë¹„ìœ¨ }}"
                    data-male2="{{ summary3.1.ë‚¨ì }}"
                    data-female2="{{ summary3.1.ì—¬ì }}"
                    data-male-rate2="{{ summary3.1.ë‚¨ìë¹„ìœ¨ }}"
                    data-female-rate2="{{ summary3.1.ì—¬ìë¹„ìœ¨ }}"
                    data-ageu18="{{ summary4.1.18ì„¸ë¯¸ë§Œ }}"
                    data-age20s="{{ summary4.1.20ëŒ€ }}"
                    data-age30s="{{ summary4.1.30ëŒ€ }}"
                    data-age40s="{{ summary4.1.40ëŒ€ }}"
                    data-age50s="{{ summary4.1.50ëŒ€ }}"
                    data-age60p="{{ summary4.1.60ëŒ€ì´ìƒ }}"
                    data-ageu18a="{{ summary5.1.18ì„¸ë¯¸ë§Œ }}"
                    data-age20sa="{{ summary5.1.20ëŒ€ }}"
                    data-age30sa="{{ summary5.1.30ëŒ€ }}"
                    data-age40sa="{{ summary5.1.40ëŒ€ }}"
                    data-age50sa="{{ summary5.1.50ëŒ€ }}"
                    data-age60pa="{{ summary5.1.60ëŒ€ì´ìƒ }}">
                    2ë…„
                </button>

                <!-- ìµœê·¼ 3ë…„ -->
                <button class="period-btn" data-year="3"
                    data-acc-count="{{ summary1.2.ì¬í•´ììˆ˜ }}"
                    data-acc-rate="{{ summary1.2.ì¬í•´ìœ¨ }}"
                    data-fatal-count="{{ summary1.2.ì‚¬ë§ììˆ˜ }}"
                    data-fatal-rate="{{ summary1.2.ì‚¬ë§ë§Œì¸ìœ¨ }}"
                    data-male="{{ summary2.2.ë‚¨ì }}"
                    data-female="{{ summary2.2.ì—¬ì }}"
                    data-male-rate="{{ summary2.2.ë‚¨ìë¹„ìœ¨ }}"
                    data-female-rate="{{ summary2.2.ì—¬ìë¹„ìœ¨ }}"
                    data-male2="{{ summary3.2.ë‚¨ì }}"
                    data-female2="{{ summary3.2.ì—¬ì }}"
                    data-male-rate2="{{ summary3.2.ë‚¨ìë¹„ìœ¨ }}"
                    data-female-rate2="{{ summary3.2.ì—¬ìë¹„ìœ¨ }}"
                    data-ageu18="{{ summary4.2.18ì„¸ë¯¸ë§Œ }}"
                    data-age20s="{{ summary4.2.20ëŒ€ }}"
                    data-age30s="{{ summary4.2.30ëŒ€ }}"
                    data-age40s="{{ summary4.2.40ëŒ€ }}"
                    data-age50s="{{ summary4.2.50ëŒ€ }}"
                    data-age60p="{{ summary4.2.60ëŒ€ì´ìƒ }}"
                    data-ageu18a="{{ summary5.2.18ì„¸ë¯¸ë§Œ }}"
                    data-age20sa="{{ summary5.2.20ëŒ€ }}"
                    data-age30sa="{{ summary5.2.30ëŒ€ }}"
                    data-age40sa="{{ summary5.2.40ëŒ€ }}"
                    data-age50sa="{{ summary5.2.50ëŒ€ }}"
                    data-age60pa="{{ summary5.2.60ëŒ€ì´ìƒ }}">
                    3ë…„
                </button>
            </div>
        </section>



        <!-- 3. í†µê³„ ì‹œê°í™” ì˜ì—­ -->
        <section id="stats-visual-area" class="stats-visual hidden"
            data-summary6='{{ summary6_json }}'
            data-summary7='{{ summary7_json }}'
            data-summary8='{{ summary8_json }}'
            data-summary9='{{ summary9_json }}'
            data-age-band="{{ age_group }}"
            data-has-selection="{% if show_detail and selected_individual %}1{% else %}0{% endif %}"
            data-selected-injury="{% if show_detail and selected_individual and selected_individual.i_injury %}{{ selected_individual.i_injury }}{% endif %}"
            data-selected-disease="{% if show_detail and selected_individual and selected_individual.i_disease_type %}{{ selected_individual.i_disease_type }}{% endif %}"
            data-has-injury="{% if individual_list %}1{% else %}0{% endif %}"
            data-risk-analysis='{{ risk_analysis_json|safe }}'>
            

            <section id="kpi-section" class="kpi-section">
                <div class="kpi-grid">
                    <div id="kpi-card-accident" class="kpi-card">
                    <h4>ì¬í•´ìœ¨</h4>
                    <p id="kpi-accident-rate"></p>
                    </div>

                    <div id="kpi-card-fatal" class="kpi-card">
                    <h4>ì‚¬ë§ë§Œì¸ìœ¨</h4>
                    <p id="kpi-fatal-rate"></p>
                    </div>

                    <div id="kpi-card-injury" class="kpi-card">
                    <h4>ë°œìƒí˜•íƒœ 1ìœ„</h4>
                    <p id="kpi-injury-top"></p>
                    </div>

                    <div id="kpi-card-disease" class="kpi-card">
                    <h4>ì§ˆë³‘ë°œìƒë¥  1ìœ„</h4>
                    <p id="kpi-disease-top"></p>
                    </div>

                    <div id="kpi-card-risk" class="kpi-card">
                    <h4>ì¢…í•© ìœ„í—˜ë„</h4>
                    <p id="kpi-risk-score"></p>
                    <span class="kpi-sub">ì¤‘ê°„ ìˆ˜ì¤€</span>
                    </div>
                </div>
            </section>

            
            <div class="visual-grid">
                <!-- ë‚´ ì—…ì¢… ì¬í•´ìœ¨ -->
                <div class="visual-card small">
                    <h3>ì¬í•´ìœ¨</h3>
                    <p id="accidentSummary"></p>
                    <p>ì¬í•´ìœ¨ - ê·¼ë¡œì 1,000ëª…ë‹¹ ë°œìƒí•˜ëŠ” ì¬í•´ììˆ˜ì˜ ë¹„ìœ¨</p>
                </div>

                <!-- ë‚´ ì—…ì¢… ì‚¬ë§ë§Œì¸ìœ¨ -->
                <div class="visual-card small">
                    <h3>ì‚¬ë§ë§Œì¸ìœ¨</h3>
                    <p id="fatalSummary"></p>
                    <p>ì‚¬ë§ë§Œì¸ìœ¨ - ê·¼ë¡œì 10,000ëª…ë‹¹ ë°œìƒí•˜ëŠ” ì‚¬ë§ììˆ˜ì˜ ë¹„ìœ¨</p>
                </div>

                <!-- ë‚¨/ë…€ ì¬í•´ í˜„í™© -->
                <div class="visual-card">
                    <h3>ë‚¨/ë…€ í˜„í™©</h3>
                    <p id="genderSummary1"></p>
                    <canvas id="genderChart1"></canvas>
                </div>

                <!-- ë‚¨/ë…€ ì¬í•´ ì‚¬ë§í˜„í™© -->
                <div class="visual-card">
                    <h3>ë‚¨/ë…€ ì‚¬ë§í˜„í™©</h3>
                    <p id="genderSummary2"></p>
                    <canvas id="genderChart2"></canvas>
                </div>

                <!-- ì—°ë ¹ëŒ€ë³„ ì¬í•´ í˜„í™© -->
                <div class="visual-card" id="card-age">
                    <h3>ì—°ë ¹ëŒ€ë³„ í˜„í™©</h3>
                    <div id="ageSummary1" class="result-box" style="margin-top:10px;"></div>
                    <canvas id="ageChart1"></canvas>
                </div>

                <!-- ì—°ë ¹ëŒ€ë³„ ì‚¬ë§ í˜„í™© -->
                <div class="visual-card" id="card-age-fatal">
                    <h3>ì—°ë ¹ëŒ€ë³„ ì‚¬ë§í˜„í™©</h3>
                    <div id="ageSummary2" class="result-box" style="margin-top:10px;"></div>
                    <canvas id="ageChart2"></canvas>
                </div>

                <!-- ë°œìƒí˜•íƒœë³„ ì¬í•´ TOP 10 (ì´ˆê¸° ìˆ¨ê¹€) -->
                <div class="visual-card" id="card-injury" style="display:none;">
                    <h3>ì¬í•´ìœ í˜• </h3>
                    <p id="injurySummary1"></p>
                    <canvas id="injuryChart1"></canvas>
                </div>

                <!-- ì‚¬ë§ì¬í•´í˜„í™© (ë°œìƒí˜•íƒœ TOP 10) (ì´ˆê¸° ìˆ¨ê¹€) -->
                <div class="visual-card" id="card-injury-fatal" style="display:none;">
                    <h3>ì‚¬ë§ì¬í•´í˜„í™© </h3>
                    <p id="injurySummary2"></p>
                    <canvas id="injuryChart2"></canvas>
                </div>

                <!-- ì¬í•´ ì§ˆë³‘ìœ í˜• (TOP 10) (ì´ˆê¸° ìˆ¨ê¹€) -->
                <div class="visual-card" id="card-disease" style="display:none;">
                    <h3>ì¬í•´ ì§ˆë³‘ìœ í˜• </h3>
                    <p id="diseaseSummary1"></p>
                    <canvas id="diseaseChart1"></canvas>
                </div>

                <!-- ì¬í•´ ì§ˆë³‘ ì‚¬ë§ í˜„í™© (ì´ˆê¸° ìˆ¨ê¹€) -->
                <div class="visual-card" id="card-disease-fatal" style="display:none;">
                    <h3>ì¬í•´ ì§ˆë³‘ ì‚¬ë§ í˜„í™©</h3>
                    <p id="diseaseSummary2"></p>
                    <canvas id="diseaseChart2"></canvas>
                </div>

                <!-- ì¢…í•© ìœ„í—˜ë„ í‰ê°€ ì¹´ë“œ -->
                <div class="visual-card highlight" id="card-risk">
                    <div class="risk-header">
                        <h3 style="margin: 0;">ì¢…í•© ìœ„í—˜ë„ í‰ê°€</h3>
                    </div>

                    <p class="risk-condition" id="riskConditionText"></p>

                    <div class="risk-section">
                        <!-- âœ… ì ìˆ˜ ì˜ì—­ (ì¶”ê°€) -->
                        <div class="risk-score-wrap" id="riskScoreWrap" style="display:none;">
                        <div class="risk-score-main">
                            <div class="risk-score-circle" id="riskScoreCircle">
                            <span class="risk-score-number" id="riskScoreNumber">ì </span>
                            </div>

                            <div class="risk-score-text">
                            <p class="risk-score-unit">ì‚°ì¬ ìœ„í—˜ë„</p>
                            <p class="risk-level" id="riskLevelText">-</p>
                           
                            </div>
                        </div>

                        <!-- âœ… breakdown(ê¸°ë³¸/ê°œì¸í™”/ì¤‘ì¦ë„) (ì¶”ê°€) -->
                        <div class="risk-breakdown" id="riskBreakdown" style="margin-top:12px;">
                            <div class="breakdown-item">
                            <span class="breakdown-label">ê¸°ë³¸ ìœ„í—˜ë„</span>
                            <span class="breakdown-value" id="breakdownBase">0</span>
                            </div>
                            <div class="breakdown-item">
                            <span class="breakdown-label">ê°œì¸í™” ìœ„í—˜ë„</span>
                            <span class="breakdown-value" id="breakdownPersonal">0</span>
                            </div>
                            <div class="breakdown-item">
                            <span class="breakdown-label">ì¤‘ì¦ë„</span>
                            <span class="breakdown-value" id="breakdownSeverity">0</span>
                            </div>
                        </div>

                        <!-- âœ… details í† ê¸€ (ìš”ì²­í•˜ì‹  â€œë²„íŠ¼ ëˆŒëŸ¬ì•¼ ì—´ë¦¼â€) -->
                        <div class="risk-details-toggle" style="margin-top:12px;">
                            <button type="button" id="toggleRiskDetailsBtn" class="details-toggle-btn">
                                ìƒì„¸ ë³´ê¸° â–¼
                            </button>

                            <!-- âœ… í† ê¸€ ëŒ€ìƒ -->
                            <div id="riskDetailsPanel" style="display:none; margin-top:16px;">

                                <!-- ğŸ“Œ ì¢…í•© ìœ„í—˜ë„ ê³„ì‚° ë°©ì‹ ì„¤ëª… -->
                                <div class="detail-block">
                                    <h5 class="detail-title">ğŸ“Š ì¢…í•© ìœ„í—˜ë„ëŠ” ì´ë ‡ê²Œ ê³„ì‚°ë©ë‹ˆë‹¤</h5>
                                    <ul class="detail-list">
                                        <li>
                                            <strong>ê¸°ë³¸ ìœ„í—˜ë„ (ìµœëŒ€ 40ì )</strong><br>
                                            ì¬í•´ìœ¨(14ì ) + ì‚¬ë§ë§Œì¸ìœ¨(26ì )
                                        </li>
                                        <li>
                                            <strong>ê°œì¸í™” ìœ„í—˜ë„ (ìµœëŒ€ 40ì )</strong><br>
                                            ì„±ë³„,ë‚˜ì´ì— ë”°ë¥¸ ë°œìƒí˜•íƒœÂ·ì§ˆë³‘ ìœ í˜• ë¹„ì¤‘ ë°˜ì˜
                                        </li>
                                        <li>
                                            <strong>ì¤‘ì¦ë„ (ìµœëŒ€ 20ì )</strong><br>
                                            ì¬í•´ ëŒ€ë¹„ ì‚¬ë§ ë¹„ìœ¨
                                        </li>
                                    </ul>
                                    <p class="detail-note">
                                        â€» ìµœì¢… ì ìˆ˜ëŠ” <strong>0~100ì </strong>ìœ¼ë¡œ ì‚°ì¶œë©ë‹ˆë‹¤.
                                    </p>
                                </div>

                                <!-- ğŸ“Œ ë‚´ ì ìˆ˜ í•´ì„ -->
                                <div class="detail-block" style="margin-top:16px;">
                                    <h5 class="detail-title">ğŸ§  í˜„ì¬ ì ìˆ˜ì— ëŒ€í•œ í•´ì„</h5>
                                    <ul id="riskExplanationList" class="detail-list">
                                        <!-- JSì—ì„œ explanation ë¬¸ì¥ ì‚½ì… -->
                                    </ul>
                                </div>

                            </div>
                        </div>

                        

                        <!-- âœ… ë°ì´í„° ìˆì„ ë•Œë§Œ ë³´ì—¬ì¤„ ì˜ì—­ -->
                        <div class="risk-grid" id="riskGrid" style="display:none;">
                        <!-- ë°œìƒí˜•íƒœ TOP 5 -->
                        <div class="risk-category">
                            <div class="risk-category-title">
                            <span class="risk-icon">âš ï¸</span>
                            ë°œìƒí˜•íƒœ TOP 5
                            </div>
                            <div class="risk-category-inner">
                            <div class="risk-list" id="injuryRiskList"></div>
                            <div class="risk-chart-wrap">
                                <canvas id="riskAccidentPie"></canvas>
                            </div>
                            </div>
                        </div>

                        <!-- ì§ˆë³‘í˜•íƒœ TOP 5 -->
                        <div class="risk-category">
                            <div class="risk-category-title">
                            <span class="risk-icon">ğŸ¥</span>
                            ì§ˆë³‘í˜•íƒœ TOP 5
                            </div>
                            <div class="risk-category-inner">
                            <div class="risk-list" id="diseaseRiskList"></div>
                            <div class="risk-chart-wrap">
                                <canvas id="riskDiseasePie"></canvas>
                            </div>
                            </div>
                        </div>
                    </div>

            <!-- âœ… ë°ì´í„° ì—†ì„ ë•Œ í‘œì‹œ -->
            <div class="risk-no-data" id="riskNoData" style="display:block; padding:40px;">
                ì¶©ë¶„í•œ í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
            </div>
    </div>
</div>




<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<script src="{% static 'js/stats/chart.js' %}"></script>
<script src="{% static 'js/stats/stats.js' %}"></script>


{% endblock %}
</body>
</html>
