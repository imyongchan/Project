{% extends "base.html" %}
{% load static %}

{% block title %}{{name}} - 산재지정의료기관 상세{% endblock %}

{% block script1 %}
<link rel="stylesheet" href="{% static 'CSS/hospital/hospital_detail.css' %}">
{% endblock %}

{% block contents %}

<div id="hospital-detail-page"
     data-kakao-key="{{ KAKAO_KEY }}"
     data-lat="{{ lat|default:0 }}"
     data-lng="{{ lng|default:0 }}"
     data-hospital-name="{{ name }}"
     data-hospital-id="{{ hospital_id }}">

  <h2 class="page-title">주변 산재지정의료기관 검색</h2>

  <!-- 1. 의료기관 기본 정보 -->
  <section class="section-box">
    <div class="section-content">
      <div class="section-header">
        <div class="hospital-title">
          <span class="hospital-name">{{ name }}</span>
        </div>
        
        <div class="hospital-meta">
          <span class="meta-distance">
            거리 :
            {% if distance_km is not None %}
              {{ distance_km }}km
            {% else %}
              -
            {% endif %}
          </span>

          <span class="meta-rating">{{ avg_rating }}</span>
          <span class="meta-stars">★★★★★</span>
          <span class="meta-review">리뷰 {{ review_count }}</span>
        </div>
      </div>

      <div class="hospital-info-row">
        <div class="info-label">주소</div>
        <div class="info-value">{{ road_address|default:address }}</div>
      </div>
      <div class="hospital-info-row">
        <div class="info-label">전화번호</div>
        <div class="info-value">{{ tel|default:"-" }}</div>
      </div>
    </div>
  </section>

  <!-- 2. 기본정보 -->
  <section class="section-box">
    <div class="section-inner-title">기본정보</div>

    <div class="basic-info-box">
      <div class="basic-info-line">
        <span class="basic-label">종별 : <span class="basic-value">{{ hospital_type }}</span> </span>
      </div>
      <div class="basic-info-line">
        <span class="basic-label">부가기능 : <span class="basic-value">{{ hospital_rc }}</span></span>
      </div>
      <div class="basic-info-line">
        <span class="basic-label">재활인증 (만료일) : <span class="basic-value">{{ hospital_rc_info }}</span></span>
      </div>
      <div class="basic-info-line">
        <span class="basic-label">진료제한 (기간) : <span class="basic-value">{{ hospital_tr }}</span></span>
      </div>
      <div class="basic-info-line">
        <span class="basic-label">의료기관평가 (평가연도) : <span class="basic-value">{{ hospital_ei }}</span></span>
      </div>
    </div>
  </section>

  <!-- 3. 위치(지도) -->
  <section class="section-box">
    <div class="section-inner-title">위치</div>
    <div id="detail-map" class="map-area"></div>
  </section>

  <!-- 4. 리뷰 -->
  <section class="section-box review-section">
    <div class="section-inner-title">리뷰</div>

    <div class="review-input-wrapper">
      <div class="review-rating-row">
        <span class="review-label">리뷰</span>
        <div class="star-group" id="review-star-group">
          <span class="star" data-star="1">★</span>
          <span class="star" data-star="2">★</span>
          <span class="star" data-star="3">★</span>
          <span class="star" data-star="4">★</span>
          <span class="star" data-star="5">★</span>
          <span class="star-score" id="review-score">0</span>
        </div>
      </div>

      <!-- 폼에 review-form-box 클래스 추가 -->
      <form id="review-form" class="review-form-box">
        {% csrf_token %}
        <textarea id="review-text"
                  class="review-textarea"
                  placeholder="리뷰를 입력하세요."></textarea>

        <!-- 버튼은 별도 컨테이너로 감싸서 우측 정렬 -->
        <div class="review-form-actions">
          <button type="submit" class="btn-review-submit">리뷰 등록하기</button>
        </div>
      </form>
    </div>

    <div id="review-list"
         data-hospital-id="{{ hospital_id }}"
         data-list-url="{% url 'Reviews:review_list' hospital_id %}"
         data-create-url="{% url 'Reviews:review_create' %}"
         data-delete-url="{% url 'Reviews:review_delete' %}">
    </div>

    <div class="review-more-wrapper">
      <button type="button" class="btn-review-more" id="btn-review-more">더보기</button>
    </div>
  </section>

</div>


  <!-- 분리된 JS 파일 로드 -->
  <script src="{% static 'JS/hospital/hospital_detail.js' %}"></script>
  <script src="{% static 'JS/hospital/hospital_review.js' %}"></script>


{% endblock %}