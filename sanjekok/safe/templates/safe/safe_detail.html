{% extends "base.html" %}
{% load static %}

{% block title %}{{ safe.s_title }} - ì•ˆì „ìë£Œì‹¤{% endblock %}

{% block script1 %}
<link rel="stylesheet" href="{% static 'CSS/safe/safe_detail.css' %}">
{% endblock %}

{% block contents %}
<section class="safe-detail-section">
  <div class="container">

    <!-- ì œëª© -->
    <div class="title-box">
      <p class="subtitle">ì‚°ì—…ì•ˆì „ ê´€ë ¨ ìë£Œ</p>
      <h2 class="safe-title">{{ safe.s_title }}</h2>
      <div class="sub-info">
        <span>ì‘ì„±ì¼: {{ safe.s_created_at|default:"-" }}</span>
        <span>ì¡°íšŒìˆ˜: {{ safe.s_view_count }}</span>
      </div>
    </div>

    <!-- ë³¸ë¬¸ -->
    <div class="detail-main row">
      <!-- ì¢Œì¸¡ ì´ë¯¸ì§€ -->
      <div class="col-md-4 left-image-box">
        {% if safe.s_image_url %}
          <img src="{{ safe.s_image_url }}" alt="ìë£Œ ì´ë¯¸ì§€" class="safe-main-img" onclick="openModal('{{ safe.s_image_url }}')">
        {% else %}
          <div class="no-image-box">ì´ë¯¸ì§€ ì—†ìŒ</div>
        {% endif %}
      </div>

      <!-- ìš°ì¸¡ ì •ë³´ -->
      <div class="col-md-8 right-info-box">

        <div class="info-line">
          <strong>ìë£Œ í˜•íƒœ :</strong> {{ safe.s_type|default:"-" }}
        </div>

        <div class="info-line">
          <strong>í‚¤ì›Œë“œ :</strong>
          {% for tag in safe.tags.all %}
            <span class="tag-item">#{{ tag.st_tag }}</span>
          {% empty %}
            <span>ë“±ë¡ëœ íƒœê·¸ ì—†ìŒ</span>
          {% endfor %}
        </div>

        <div class="info-line">
          <strong>ì¶œì²˜ :</strong> ì•ˆì „ë³´ê±´ê³µë‹¨(KOSHA) Â· ê³µê³µëˆ„ë¦¬ {{ safe.s_publisher|default:"KOSHA" }}
        </div>

        <div class="content-box mt-3">
          <h5>ë‚´ìš©</h5>
          <p>{{ safe.s_contents|linebreaks }}</p>
        </div>

        <!-- ìœ íŠœë¸Œë™ì˜ìƒ(safe.s_video_url) ì´ ìˆì„ ì‹œ -->
        {% if safe.s_video_url %}
        <div class="video-wrapper mt-4">
          <iframe
            src="{{ safe.s_video_url }}"
            width="100%"
            height="420"
            title="{{ safe.s_title }}"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen>
          </iframe>
          <p class="video-notice">â€» ë³¸ ì˜ìƒì€ ì™¸ë¶€ í”Œë«í¼(YouTube)ì—ì„œ ì œê³µë˜ëŠ” ìë£Œì…ë‹ˆë‹¤.</p>
        </div>
        {% endif %}

        <div class="download-wrapper mt-4">
          <a href="{{ safe.s_link }}" target="_blank" class="btn btn-download">
            ğŸ“‚ ìë£Œ ë‹¤ìš´ë¡œë“œ (KOSHA ì›ë³¸)
          </a>
          <p class="download-note">â€» ì›ë³¸ í˜ì´ì§€ì—ì„œ ì²¨ë¶€íŒŒì¼ í˜•íƒœë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      
        <!-- ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
        <div class="list-btn-wrapper mt-5">
          <a href="{% url 'Safe:safe_list' %}" class="btn btn-list">
            â† ëª©ë¡ìœ¼ë¡œ
          </a>
        </div>
      </div>

    </div>

    <!-- ì—°ê´€ ì½˜í…ì¸  -->
    <div class="related-section mt-5">
      <h4>ì—°ê´€ ì½˜í…ì¸ </h4>
      <div class="related-list row">
        {% for item in related_list %}
        <div class="col-md-3 related-item">
          <a href="{% url 'Safe:safe_detail' item.id %}">
            <img src="{{ item.s_image_url }}" alt="ì—°ê´€ ìë£Œ" class="related-img">
            <div class="related-title">{{ item.s_title }}</div>
          </a>
        </div>
        {% empty %}
        <p class="text-muted">ì—°ê´€ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
<div id="imgModal" class="modal-image" onclick="closeModal()">
  <span class="modal-close" onclick="closeModal()">Ã—</span>
  <img id="modalImg"
       class="modal-content-img"
       onclick="event.stopPropagation();">
</div>

<script src="{% static 'js/safe/safe_detail.js' %}"></script>
{% endblock %}
